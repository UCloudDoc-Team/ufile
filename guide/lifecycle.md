

# 生命周期

用户可以通过创建存储空间（Bucket）生命周期规则，实现存储空间内所有文件或特定前缀文件的生命周期管理（可以配置一个或者多个规则），设置生命周期规则转换存储类型或删除文件操作。

* 删除文件：支持设置指定的文件在 N 天后被自动删除。

* 转低频存储：可以设置指定的文件在 N 天后，自动转换成低频存储类型。

* 转归档存储：可以设置指定的文件在 N 天后，自动转换成归档存储类型。

**使用说明**：存储类型转换和删除文件操作的开始时间是如何计算的呢？

US3将对象上传时间与设置天数相加，得到的时间入到后一天的午夜（CST: 中国标准时间），从而得到对象操作开始时间。例如对象在 2015年1月1日 上午 10:00 CST 上传，设置在 7 天后被删除，则会在 2015年1月9日 00:00 CST 之后当天内删除文件。

**注：设置生命周期规则后，第二天的00:00会开始执行生命周期操作，删除操作不可恢复，请谨慎设置。如一个文件为用户在 31 天前上传，用户配置了生命周期规则为删除 30 天前的文件，则 US3 服务在生命周期规则被设置的第二天00:00会自动执行删除该文件的操作。**

## 使用场景

通过生命周期规则，用户可以更高效的管理存储的数据，节省大量人力及存储成本。用户可以通过设置匹配特定前缀的规则，定期将非热门数据转换为低频访问或归档存储，将不再需要访问的数据删除。例如：

1. 监控视频上传，根据相关条例，监控保存时间一般规定如下：一般小区的是7天；一般娱乐场所是 15 天；金融行业是 26 天；银行 3 个月到半年。可以通过设置生命周期规则，上传的文件，会在匹配规则命中后，根据上传时间，到达指定天数后自动过期删除，从而减少存储量，降低成本。

2. 电子公文类数据，根据相关条例，需要长期保存达 10 年，超过 1 年的电子公文调阅次数减少，超过 3 年的电子公文通常不再被调阅。可以通过设置生命周期规则，上传的文件，会在匹配规则命中后，根据上传时间，到达指定天数后自动转低频、归档存储，从而降低存储的单位成本。

## 注意事项

1. 存储空间的生命周期功能一旦开启，对存储空间内所有符合规则范围的文件生效（包括开启生命周期功能前上传的文件），并于后一天的 00:00 触发生命周期规则，请确认无误后再保存生命周期规则。

2. 删除文件的操作是不可逆的，请根据您的需求合理设置生命周期规则，避免重要数据丢失。

## 管理生命周期

1. 选择对应存储空间，在右侧操作中单击生命周期按钮。

![](/images/guide/管理生命周期1.png)

2. 单击添加规则按钮。

![](/images/生命周期2.png)

3. 设置生命周期规则界面。

![](/images/guide/添加生命周期规则2.png)

| 字段     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 规则名称 | 用户可以设置一个规则名称，记录自己创建的规则。               |
| 规则范围 | 指定规则的生效范围，选择整个存储空间时，生命周期规则对整个存储空间生效；<br>选择指定前缀时，仅对该存储空间下的指定前缀生效。 |
| 对象标签 | 生命周期规则仅针对拥有指定标签生效。对象前缀和对象标签、对象标签和对象标签之间都为“与”的关系（即所有条件需同时满足）。对象标签详情请参见[对象标签](https://docs.ucloud.cn/ufile/guide/object_tagging) 。 |
| 规则配置 | 选择需要执行的生命周期规则和规则的触发时间，最小为 7 天，具体计算方式请参考备注说明。 |


**注: 指定前缀时，无需在最前面添加额外的"/"。**  

4. 生命周期规则添加完成后默认生效，生效状态具体可见状态栏，用户可以通过操作栏的其他按钮，进行相应的修改以及关闭操作。

![](/images/生命周期6.png)

**注：单击禁用或者删除按钮以后，状态修改在第二天生效，不影响当天 00:00 已触发但未执行完成的任务继续执行。**


## 计费说明

使用生命周期规则时，会产生如下费用，价格详情请参见[产品价格](https://docs.ucloud.cn/ufile/bill/billing)：

1. **请求费用**：

- 转换文件存储类型产生的请求费用，即从标准存储类型转换为低频访问存储类型时，按标准存储类型的请求次数收取请求费用。从低频存储类型转换为归档存储类型时，按低频存储类型的请求次数收取请求费用。

- 删除文件产生的请求费用，按文件被删除时的存储类型收取请求费用。

2. **存储费用**：根据用户存储的文件类型、大小和时长收取一定的存储费用。

- 文件最小计量单位限制：单个文件小于64KB，按照64KB计算；大于或等于64KB，按照实际大小计算。

- 不足规定时长存储费用：

    - 通过生命周期将文件存储类型转换为低频访问，且在不足规定时长前删除文件：低频访问类型最低存储时间（30天）以文件存储在US3的时间开始计算。例如标准类型的文件在其创建10天后，通过生命周期将其转换为低频访问，过了2天后将其删除，则会产生18天的低频访问不足规定时长存储费用。
    
    - 通过生命周期将文件存储类型转换为归档访问，且在不足规定时长前删除文件：归档访问类型最低存储时间（60天）以文件存储在US3的时间开始计算。例如标准类型的文件在其创建10天后，通过生命周期将其转换为归档访问，过了5天后将其删除，则会产生45天的低频访问不足规定时长存储费用。

3. **数据取回费用**：

- 通过生命周期将存储类型从低频转换为归档时，会产生低频取回费用。例如某个低频类型的文件降冷转换为归档，则US3需要先获取原低频存储文件，从而产生低频取回费用。并且成功降冷后，原低频文件被删除也产生删除请求费用。

4. **对象标签费用**：

- US3对象存储按照用户存储空间（Bucket）内对象标签的数量，按天计算对象存储标签费用，单价是0.00189 元/每万个标签。

## 生命周期执行优先级

1. 若同时满足删除和沉降操作，优先执行删除操作；
2. 若同时满足多条删除操作，优先匹配时间更短的删除操作；
3. 若同时满足多条沉降操作，优先匹配目标存储类型更冷的沉降操作；

## 备注

1. 低频存储和归档存储类型都有最短存储期限，早于最短存储期限删除、修改、覆盖文件，需要补足未满最短存储期限的剩余天数的存储费用。

2. 生命周期规则的自动操作触发时间是如何计算的呢？US3 将文件上传时间与设置天数相加，计算得到时间的后一天的00:00（CST: 中国标准时间）即为自动操作开始时间。例如文件在 2015年1月1日 上午 10:00 CST 上传，设置在 7 天后被删除，那么会在 2015年1月9日 00:00 CST 后触发自动删除文件操作。

3. 当前生命周期规则里的对象标签仅越南、巴西、华北一、华北二、广东、上海、香港支持，其他地域如有需要请联系技术支持。

4. 生命周期不支持归档转低频，不支持低频转标准。归档转低频、低频转标准方法参考：[归档转标准/低频存储类型](https://docs.ucloud.cn/ufile/solutions/class_switch_for_archive)。
